sudo: required

services:
  - docker

# We don't actually use anything java, but this feels the least jarring "language"
language: java

# Special tags are used to trigger these Travis CI runs
branches:
  only:
    - /^release-.*$/

# jq is used in release.sh to parse the responses of the quay.io API
install:
  - sudo wget https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64 -O /usr/local/bin/jq
  - sudo chmod o+x /usr/local/bin/jq

before_script:
  # The release process pushes to GitHub multiple times; will use these credentials
  - openssl aes-256-cbc -K $encrypted_1f60458c9a9e_key -iv $encrypted_1f60458c9a9e_iv -in .travis/deploy_key.enc -out .travis/deploy_key -d
  - eval "$(ssh-agent)"
  - ssh-add .travis/deploy_key
  # Log in to Docker Hub, needed to mirror images built on quay.io
  - docker login -e abesto0+docker-zipkin-deployer@gmail.com -u dockerzipkindeployer -p "$DOCKERHUB_PASSWORD"

env:
  global:
    # The release process syncs minor and major version tags to the newly built subminor version tag
    # via the quay.io API, using these credentials.
    secure: "acmhzKdohRCGlYnUISPlA2uXOeq+YhKJrLCr8wH9sQmb4mX+IuxxidxTxcqpKPD/Mi5YbAvVVPbWU5F763EAPkbMgI2Gk0HObdRSNyx0yrJ4aTBGuQRCz1Wmd7UFoILm4w+XWcZTnd3xXguEFliqYxjNoIuhCF21A6xEFpJotgs="
    # The release process pushes images to Docker Hub, using these credentials
    secure: "Od7vv7FA1dUiu2cUanKwXefetOxKeKJfmFho7SAt6tC3itaMRiRnAjDn2xMv7wA+z9WXfBI8RDjm+JhOR6lrqg9tfhb5dknWa10sxCXGLz0jW8mVH57i/GuJ+Omv7I6gIbIaV63SfsflGQuCQNt8V0u8Dm4WxTBTqwaXeZlzMNY="

# Also known as doit.sh
script: ./release.sh $TRAVIS_TAG

